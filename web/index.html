<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hollow Men Performer View</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="stats-hud">
        OSC: <span id="osc-val">0</span> m/s &nbsp;|&nbsp; GPU: <span id="gpu-val">0</span> fps
    </div>

    <div id="video-container"></div>

    <div id="performance-footer">
        <div class="footer-content">
            <div id="event-num">0</div>
            
            <div class="gesture-item">
                <span class="label">Current Gesture</span>
                <span id="curr-g-val" class="value">--</span>
            </div>
            
            <div class="gesture-item">
                <span class="label">Next Gesture</span>
                <span id="next-g-val" class="value" style="color: #f0f;">--</span>
            </div>
        </div>
    </div>

    <script>
        // We still keep the fallback onerror handling just in case
        const images = document.querySelectorAll('.stream-img');
        images.forEach(img => {
            img.onerror = () => img.parentElement.style.display = 'none';
        });

        async function update() {
            try {
                const r = await fetch('/api/status');
                const d = await r.json();
                
                document.getElementById('event-num').innerText = d.event;
                document.getElementById('curr-g-val').innerText = (d.current || "IDLE").replace(/_/g, " ");
                document.getElementById('next-g-val').innerText = (d.next || "END").replace(/_/g, " ");
                document.getElementById('osc-val').innerText = Math.round(d.mps_osc);
                document.getElementById('gpu-val').innerText = Math.round(d.fps_gpu);

                // INSTANT LAYOUT SNAP
                // If the server says there is only 1 camera, hide slot 1 immediately.
                const cells = document.querySelectorAll('.video-cell');
                if (d.active_count < 2) {
                    cells[1].style.display = 'none';
                    cells[0].style.display = 'flex'; // Ensure slot 0 is visible and fills space
                } else {
                    cells[0].style.display = 'flex';
                    cells[1].style.display = 'flex';
                }

            } catch(e) {}
        }
        setInterval(update, 100);
    </script>
    </script>
</body>
</html>